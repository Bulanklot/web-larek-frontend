# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- srs/components/common - папка с модальными окнами

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении 

### Типы 
- `ApiListResponse<Type>` : тип данных ответа сервера , колличество элементов и массив элементов.
- `ApiPostMethods` : описывает методы обращения к серверу.
- `FormErrors` : опиывает ошибки формы в виде пар "ключ: значение", ключ - поле формы, значение - строка с текстом ошибки.
- `PaymentType` : описывает варианты формы оплаты : наличными и онлайн.
- `OrderForm` : тип описывающий поля Форм для создания  заказа.
- `ProductId` : тип описывающий данные для отображения товара.

### Интерфейсы

- `IProduct` : данные о товаре.
- `IEvents`: методы работы с событиями.
- `IPaymentForm` : форма с данными о доставке и типом оплаты.
- `IContactsForm:` форма с данными о контактах: телефон, почта.
- `IOrder`: заказ.
- `IBasket`: корзина товаров.
- `IFormStatus` - состояние формы.
- `IOrderResult` - результат заказа.
- `IComplete` - заказ выполнен.
- `IActions` - действие при клике.
- `IModal` - интерфейс для модального окна.
- `IApiLarek` - интерфейс описывающий методы для работы с API магазина.
- `IPage` - интерфейс страницы:  каталог , счётчик и блокировка.

#### объект настройки категорий товара 
- `categorySettings` - объект, хранящий данные в парах ключ-значение ,где ключ - название категори, а значение - соответствующий селектор.

## Архитектура приложения
- Код приложения разделён на слои согласно архитектурному шаблону MVP.
- Cлой Model - управляет данными приложения, осуществляет бизнес-логику и хранение данных.
- Слой View - отвечает за отображение данных на устройстве пользователя.
- Слой Presenter - слой отвечающий за связь между View и Presenter , получает данные из Model и передает их в View для отображения. Для связи между слоями будет использоваться брокер событий.


## Базовый Код

### Класс Api

Класс описывающий базовую логику для отправки запросов на сервер. В конструкторе принимается базовый адрес сервера и опциональный объект с заголовками запросов

Методы класса:

- `get` - выполняет GET запрос на указанный ендпоинт и возвращает промис с ответом сервера
- `post` - отправляет данные в формате JSON на указанный ендпоинт методом POST. Метод запроса можно переопределить, указав третий параметр при вызове метода
- `handleResponse` - обработчик ответа сервера

### Класс EventEmitter
Брокер событий - позволяет отправлять и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы , реализуемые классом описаны интерфейсом `IEvents`:
- `on` - установить обработчик на событие
- `emit` - инициализация события c возможностью передачи данных
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие.

Так же описаны методы : 
- `onAll` - подписаться на все события
- `ofAll` - сбросить все обработчики
- `off` - снять обработчик с события

### Класс Сomponent
Абстрактный класс для отображения пользовательского интерфейса. Он содержит обобщённый тип Т - тип данных, которые будут использоваться в компоненте,в конструкторе принимает элемент разметки.
 

- Методы класса : 

- `toggleClass` - переключатель класса переданного элемента.
- `setText` - устанавливает текст
- `setImage` - устанавливает изображение
- `setDisabled` - устанавливает состояние блокировки
- `render` - возвращает корневой DOM-элемент с заполненными данными

### Класс View
Наследует Класс Component и представляет собой компонент пользовательского интерфейса с возможностью обработкий событий.
Добавляет возможность работы с событиями через объект EventEmitter

## Слой Model 

### Класс AppData
Класс обеспечивающий работу с данными в приложении 

Свойства:

- `items` - данные всех товаров
- `basket` - данные корзины пользователя
- `order` - данные для заказа
- `formErrors` - ошибки валидации формы

Методы : 

- `setItems` - метод для инициализации всего списка товаров, полученных с сервера
- `setPreview` - устанавливает текущий товар для предпросмотра
- `inBasket` - проверяет, есть ли товар в корзине
- `addToBasket` - добавляет товар в корзину
- `removeFromBasket` - удаляет товар из корзины.
- `clearBasket` - очищает корзину
- `setOrder` - устанавливает поле заказа
- `checkValidation` - Проверяет корректность данных формы заказа

### Класс ApiLarek
Наследует класс Api, предназначен для взаимодействия с API интернет-магазина, включая получение списка продуктов, данных конкретного продукта и отправку заказов.

Свойства:

- `cdn` - только для чтения 

Методы: 

- `getProductList` - получает список товаров, возвращает массив объектов . Каждый товар включает обновленный путь изображения через CDN.
- `getProductItem` - получает информацию о конкретном продукте по его ID и возвращет объект с информацией о продукте
- `orderProducts` - отправляет заказ на сервер

## Слой View

### Класс Page
Класс для реализации главной страницы приложения: каталог товаров, счётчик корзны, отображение модального окна. Наследует класс View и будет использовать данные описанные интерфейсом IPage. 

Свойства :

- `_counter` - счётчик товаров корзины
- `_catalog` - отображение каталога товаров
- `_wrapper` - элемент обёртки страницы
- `_basket` - кнопка открытия модального окна с корзиной

Методы : 

- `set counter` - устанавливает значение счётчика 
- `set catalog` - наполняет содержимое каталога полученными данными
- `set locked` - блокирует прокрутку страницы при открытии модального окна

### Класс Modal 
Класс для реализации модальных окон. Наследует класс Сomponent. Конструктор которого принимает брокер событий и контейнер.

Свойства : 
- `_сloseButton` - кнопка для закрытия модального окна
- `_content` - контент отображаемый внутри модального окна

Методы:

- `set content` - заполнение контента модального окна
- `open` - открытие модального окна
- `close` - закрытие модального окна
- `render` - отображение модального окна.

### Класс Basket
Класс для отображения корзины и отображения списка выбранных товаров, а так же добавление и удаление этих товаров.

Свойства :

- `_itemList` - список товаров
- `_total` - общая стимость
- `button` - кнопка для дальнейшего оформления покупки

Методы:

- `set items` - устанавливает список товаров в корзине 
- `set total` - устанавливает общую  стоимость всех товаров

### Класс Сomplete
Класс для отображения сообщения об успешной покупке и отображение общей суммы операции, наследует класс Сomponent

Свойства : 
- `_totalPrice` - элемент для отображения общей суммы операции
- `_events`- событие при клике на кнопку после завершения заказа
- `close`- кнопка для закрытия модального окна.

Методы:
- `set total` - установка суммы списания

### Класс Form
Класс для создания форм с различным контентом, наследует класс Component. Устанавливает обработчики на все формы , и обрабатывает ввод данных , показывает сообщения об ошибках 

Свойства :

- `_submit` - элемент кнопки для отправки формы

- `_errors` - элемент отображения ошибок формы

Методы :

- `onInputChange` :  обработка событий ввода , и оповещение всех слушателей об изменении
- `set valid` : изменяет состояние кнопки отправки
- `set errors` : отображает ошибки валидации формы
- `render` : отображение формы

### Класс PaymentForm 
Класс для отображения формы доставки, наследует класс Form.

Свойства : 

- `_paymentOnline` - кнопка онлайн оплаты
- `_paymentCash` - кнопка оплаты наличными 

Методы:

- `set address` - устанавливает адре доставки
- `set payment` - переключение активности кнопок оплаты

### Класс СontacForm
Класс для реализации формы контактных данных , наследует класс Form

Методы класса:

- `set phone` - устанавливает контактный телефон
- `set email` - устанавливает адрес электронной почты

### Класс ProductView 
Класс для реализации отображения карточки товара и настройки его элементов.
Наследует класс Component работает с типом ProductId


Свойства :
- `_title` - элемент отображения название товара
- `_price` - элемент отображения цены товара
- `_image` - изображение товара
- `_button` - элемент для добавления товара в корзину
- `_description` -  элемент отображения описания товара
- `_category` - элемент отображения категории товара
- `_index` - элемент для установки индекса товара

Методы :

- `set title` - установка названия товара
- `get title` - получение названия товара
- `set index` - установка индекса товара
- `get index` - получение индекса товара
- `set price`/`get price` - установка/получение цены товара
- `set image` - установка изображения товара 
- `set description`- установка описания товара
- `set/get category` - установка/получение категории товара
- `set/get id` - установка/получение идентификатора товара
- `set buttonTitle` - установка текста на  элемент кнопки

## Слой Presenter

События:

- `items:change` - изменение списка товаров
- `modal:open` - открытие модального окна
- `modal:close` - закрывает модальное окно
- `preview:change` - отображает модальное окно с информацией о товаре 
- `^contacts\..*:change` - изменение полей контактной информации , обновление контактных данных в приложении
- `^order\..*:change` - изменение адреса заказа , обновление поля в приложении
- `contacts:submit` - отправка контактной информации
- `basket:open` - открытие модального окна корзины
- `basket:change`- изменение товаров в корзине
- `card:select`-  выбор карточки товара, превью товара
- `formErrors:change` - изменение ошибок в форме заказа, обновление состояния валидации и ошибок форм оплаты и  контактов
- `order:submit` - отправляет данные заказа на сервер
- `order:success` - отображает окно успешной оплаты 
- `order:result` - закрывает модальное окно и очищает корзину